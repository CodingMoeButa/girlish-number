/* 2019-06-27 16:21:30.366635 */
"use strict";var taxy;!function(t){var e=function(){function t(){}return t.CGI_PASS_URL=function(t){var e="3splayer"===t?location.host:t.replace(/https?:\/\/([^\/]+)(?::\d+)?(?:$|.+$)/,"$1");return"wwwinternal-test.tbs.co.jp"==e||"newsinternal-test.tbs.co.jp"==e||"news-test.tbs.co.jp"==e||"cgi-test.tbs.co.jp"==e?"//recv-test.tbs.co.jp/taxy/passenger":"//recv.tbs.co.jp/taxy/passenger"},t.VERSION="2.1.2",t.IFRM_URL=(0<=location.host.indexOf("local")?"":"//scis.tbs.co.jp")+("wwwinternal-test.tbs.co.jp"==location.host||"newsinternal-test.tbs.co.jp"==location.host||"news-test.tbs.co.jp"==location.host||"cgi-test.tbs.co.jp"==location.host?"/taxy/7d800f1881d22a6c73138d05d6b47f6e/index-test.shtml":"/taxy/7d800f1881d22a6c73138d05d6b47f6e/index-"+t.VERSION+".shtml"),t.MST_DOMAIN=new RegExp("^www.tbs.co.jp$"),t.CGI_REG_URL="//cgi.tbs.co.jp/cheetah/regist.do",t.CGI_HASH_URL="//cgi.tbs.co.jp/taxy/hashdata",t.CGI_CONVERT_SESSION_TC_URL="//cgi.tbs.co.jp/taxy/hashdata",t.C_CHK_HOUR=!1,t.C_CHK_ALL=!1,t}();t.Const=e}(taxy||(taxy={})),function(t){var e=function(){function r(){}return r.load=function(t,e,s,n){var i=document.createElement("iframe");i.style.display="none",document.body.appendChild(i);var a=i.contentWindow.document,o=0;i[i.readyState?"onreadystatechange":"onload"]=function(){this.readyState&&"complete"!=this.readyState||o++||(a.jsonpArgs?e&&e.apply(this,a.jsonpArgs):n&&1<n?setTimeout(function(){r.load(t,e,s,n-1)},1e3):s&&s(),setTimeout(function(){try{i.parentNode.removeChild(i)}catch(t){}},0))};var l=t+(t.indexOf("?")<0?"?":"&")+"callback=cb";return a.write('<script>function cb(){document.jsonpArgs=arguments}<\/script><script src="'+l+'" charset="utf-8"><\/script>'),a.close(),i},r.abort=function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},r}();t.Jsonp=e}(taxy||(taxy={})),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){var s=this.toString();("number"!=typeof e||!isFinite(e)||Math.floor(e)!==e||e>s.length)&&(e=s.length),e-=t.length;var n=s.lastIndexOf(t,e);return-1!==n&&n===e}),function(P){var t=function(){function M(){}return M.getRndParam=function(){return"[AQB]"+(new Date).getTime()},M.publisher=function(t){var e=t,s=new RegExp("news.*\\.tbs\\.co\\.jp");return e.match(s)?"news":"spstore.tbs.co.jp"===e?"spstore":"ishop.tbs.co.jp"===e?"ishop":"tbs-blog.com"===e?"tbs-blog":"tbs"},M.passenger=function(t,e,s,n,i,a,o,l,r,c,u,d,p){var h=P.Const.CGI_PASS_URL(unescape(o))+"?"+M.getRndParam(),f=t&&"string"==typeof t?JSON.parse(t):null,g=p&&"string"==typeof p?JSON.parse(p):null;(!f&&g||f&&g&&!f["tbs-chth-id2"]&&g["tbs-chth-id2"])&&(f=g);var m=f?f["tbs-chth-id2"]:"",_=f?f["tbs-chth-token"]:"",S=new RegExp("^/([^/]+).*$"),y=new RegExp("[^/]+.s?html?$"),w=s.replace(S,"$1").replace(y,"");if(w="/"===w?"":w,"tbs"===n&&("anime"===w||"sports"===w||"event"===w||"radio"===w)){var E=new RegExp("^/"+w+"(.*)$"),x=s.replace(E,"$1").replace(S,"$1").replace(y,"");(x="/"===x?"":x)&&(w+="__"+x)}var A=s.match("^/program/(.+)\\.html$");A&&(w=A[1]),h+="&id2="+m+"&expire="+_+"&ua="+i+"&referer="+a+"&url="+o+"&id3="+("tbs,"+w+",,"+n)+"&id21="+(l?"1":"0");var R=null!=e?JSON.parse(e):null,b=c?JSON.parse(c):null,v=!(null!=b&&!b.retry);null!=b&&(h+="&id22="+(b.retry?"1":"0"));var O=null,I=null,N=null,T=null;if(v?l||null==R||(O=R.id1,I=R.uuid,N=R.type,T=R.seed):l||null==R?(O=b.id1,I=b.uuid,N=b.type,T=b.seed):(O=R.date>=b.date?R.id1:b.id1,I=R.date>=b.date?R.uuid:b.uuid,N=R.date>=b.date?R.type:b.type,T=R.date>=b.date?R.seed:b.seed),null!=O&&(h+="&id1="+O),null!=I&&(h+="&uuid="+I),null!=N&&(h+="&type="+N),null!=T&&(h+="&seed="+T),!l&&"string"==typeof r&&0<r.length&&(h+="&id14="+r),("string"==typeof u&&u.match(new RegExp("^\\d+$"))||"number"==typeof u)&&(h+="&id6="+u),("string"==typeof d&&d.match(new RegExp("^\\d+$|^all$"))||"number"==typeof d)&&(h+="&id15="+d),null!=g){var C=g["tbs-chth-id2"],L=g["tbs-chth-token"];"string"==typeof C&&"string"==typeof L&&(h+="&id23="+C+"&id24="+L)}document.createElement("img").src=h},M.regist=function(t){P.Jsonp.load(P.Const.CGI_REG_URL+"?"+M.getRndParam(),t,function(){console.error("failed call taxy regist...")})},M.add=function(t,e,s,n,i){try{t="string"==typeof t&&t.match("^\\d+$")?t:"number"==typeof t?t.toString(10):"x",e="string"==typeof e&&e.match("^[0123]$")?e:"number"==typeof e?e.toString(10):"x",s=null!=s&&"string"==typeof s?s:null,n="string"==typeof n&&n.match("^\\d+$")?n:"number"==typeof n?n.toString(10):null;var a=P.Const.CGI_HASH_URL+"?age="+t+"&gender="+e;s&&(a+="&type="+s),n&&(a+="&seed="+n),P.Jsonp.load(a,i,function(){console.error("failed call taxy hashdata...")})}catch(t){}},M.conv=function(t,e,s){try{"string"!=typeof t&&(t=""),P.Jsonp.load(P.Const.CGI_CONVERT_SESSION_TC_URL+"?session_tc="+t,e,function(){console.error("failed call taxy session_tc convert..."),s&&s()})}catch(t){}},M}();P.TaxyUtil=t}(taxy||(taxy={})),function(t){var e=function(){function t(){}return t.GET_COOKIE="getCookie",t.SAVE_EXT="saveExt",t.SAVE_CUSTOM="saveCustom",t.SAVE_SESSION="saveSession",t.SAVE_ALL="saveAll",t}();t.MessageMethod=e}(taxy||(taxy={})),function(p){var t=function(){function d(){if(this.iframe=null,this.iframeReady=!1,this.queue=[],this.requests={},this.origin=null,this.messageId=0,this.cookieRetry=0,this.ua=navigator.userAgent?navigator.userAgent:"",this.referrer=document.referrer?document.referrer:"",this.url=location.href?location.href:"",this.pathname=location.pathname?location.pathname:"",this.domain=location.hostname?location.hostname:"",this.lsOldData=window.localStorage.getItem(d.LS_OLD_DAT)?window.localStorage.getItem(d.LS_OLD_DAT):"",this.lsOldExt=window.localStorage.getItem(d.LS_OLD_EXT)?window.localStorage.getItem(d.LS_OLD_EXT):"",this.createNew=!1,this.optout=!1,this.forceOptout=!1,this.forceOptin=!1,this.webview=!1,this.sent=!1,d.instance=this,new RegExp("^news.*\\.tbs\\.co\\.jp$").test(this.domain)){var t=window.localStorage.getItem(d.LD_SYS_REFERER);if(window.localStorage.setItem(d.LD_SYS_REFERER,""),t&&0<t.length){this.referrer=t;var e=this.url.split("?");e[0].endsWith(".htm")&&(e[0]+="l"),this.url=e.join("?")}}this.publisher=p.TaxyUtil.publisher(this.domain);var s=document.currentScript||function(){for(var t=document.getElementsByTagName("script"),e=0;e<t.length;e++){var s=t.item(e);if(null!=s&&0<=s.src.split("?")[0].indexOf("/taxy"))return s}return t.item(t.length-1)}(),n=s.src.indexOf("?");if(0<=n)for(var i=s.src.substring(n+1).split("&"),a=0;a<i.length;a++){var o=i[a].split("=");if(o[0]===d.JSPARAM_OPTOUT){if("1"===o[1]){this.forceOptout=!0;break}if("0"===o[1]){this.forceOptin=!0;break}}else o[0]===d.JSPARAM_WEBVIEW&&(this.webview=!0)}var l,r=window.localStorage.getItem(d.LS_NEW_TAXY);if(l=r?JSON.parse(r):{data:null,ext:null,custom:null,optout:!1,session_tc:null,apl:null,c_ts:0},this.forceOptout)return l.optout=!0,window.localStorage.setItem(d.LS_NEW_TAXY,JSON.stringify(l)),void this.createIframe();if(this.forceOptin)return l.optout=!1,window.localStorage.setItem(d.LS_NEW_TAXY,JSON.stringify(l)),void this.createIframe();this.webview?l.data&&l.data["tbs-chth-id2"]||l.apl&&l.apl["tbs-chth-id2"]||(this.createNew=!0):l.data&&l.data["tbs-chth-id2"]||(this.createNew=!0),this.optout=l.optout;var c=new Date(l.c_ts),u=new Date;!l.data||c.getFullYear()!==u.getFullYear()||c.getMonth()!==u.getMonth()||c.getDate()!==u.getDate()||p.Const.C_CHK_HOUR&&c.getHours()!==u.getHours()||p.Const.C_CHK_ALL?(this.createIframe(),this.getCookie()):(this.sent=!0,this.webview||p.TaxyUtil.passenger(JSON.stringify(l.data),null!=l.ext?JSON.stringify(l.ext):null,this.pathname,this.publisher,escape(this.ua),escape(this.referrer),escape(this.url),this.optout,l.session_tc,null!=l.custom?JSON.stringify(l.custom):null,null,null,JSON.stringify(l.apl)),d.finished=!0,this.parseWebViewParam(l))}return d.prototype.sendRequest=function(t){this.requests[t.data.id]=t,this.iframe.contentWindow.postMessage(JSON.stringify(t.data),this.origin)},d.prototype.iframeLoaded=function(){if(this.iframeReady=!0,this.queue.length){for(var t=this.queue.length,e=0;e<t;e++)this.sendRequest(this.queue[e]);this.queue=[]}},d.prototype.handleMessage=function(e){if(e.origin===this.origin&&e.source===this.iframe.contentWindow){var t=void 0;try{t=JSON.parse(e.data)}catch(t){return void console.warn("不明なメッセージを受信："+e.data)}this.requests[t.id].callback&&this.requests[t.id].callback(t),delete this.requests[t.id]}},d.prototype.parseWebViewParam=function(e){var s=this;if(this.webview){null==this.iframe&&this.createIframe(),e.data=e.data?e.data:{"tbs-chth-id1":null,"tbs-chth-id2":null,"tbs-chth-token":null,"tbs-chth-chlg":null},e.apl=e.apl?e.apl:{"tbs-chth-id1":null,"tbs-chth-id2":null,"tbs-chth-token":null,"tbs-chth-chlg":null},e.ext=e.ext?e.ext:{id1:null,uuid:null,type:null,seed:null,date:0},e.apl["tbs-chth-id2"]&&e.apl["tbs-chth-token"]||(e.apl["tbs-chth-id2"]=e.data["tbs-chth-id2"],e.apl["tbs-chth-token"]=e.data["tbs-chth-token"]);for(var t=location.search.substring(1).split("&"),n=0;n<t.length;n++){var i=t[n].split("=");if(!(i.length<2))if(i[0]===d.PAGEPARAM_BRWSCID)e.data["tbs-chth-id2"]=i[1];else if(i[0]===d.PAGEPARAM_BRWSEXP)e.data["tbs-chth-token"]=i[1];else if(i[0]===d.PAGEPARAM_BRWSID1)e.ext.id1=i[1];else if(i[0]===d.PAGEPARAM_BRWSUUID)e.ext.uuid=i[1];else if(i[0]===d.PAGEPARAM_BRWSSEED)e.ext.seed=i[1];else if(i[0]===d.PAGEPARAM_BRWSDATE)try{e.ext.date=parseInt(i[1],10)}catch(t){e.ext.date=0}else i[0]===d.PAGEPARAM_BRWSID21&&(e.optout="1"===i[1])}window.localStorage.setItem(d.LS_NEW_TAXY,JSON.stringify(e)),this.sendMessage(p.MessageMethod.SAVE_ALL,{data:e.data,ext:e.ext,custom:e.custom,optout:!1,session_tc:e.session_tc,apl:e.apl},function(t){p.TaxyUtil.passenger(JSON.stringify(e.data),null!=e.ext?JSON.stringify(e.ext):null,s.pathname,s.publisher,escape(s.ua),escape(s.referrer),escape(s.url),s.optout,e.session_tc,null!=e.custom?JSON.stringify(e.custom):null,null,null,JSON.stringify(e.apl))})}},d.prototype.loadCookie=function(t){if(!(this.cookieRetry>=d.MAX_COOKIE_RETRY))if(null!=t.data){var e={data:null,ext:null,custom:null,optout:!1,session_tc:null,apl:null,c_ts:0};t.data.data&&(e.data=t.data.data),t.data.ext&&(e.ext=t.data.ext),t.data.custom&&(e.custom=t.data.custom),t.data.optout&&(e.optout=t.data.optout),t.data.session_tc&&(e.session_tc=t.data.session_tc),t.data.apl&&(e.apl=t.data.apl),e.c_ts=(new Date).getTime(),window.localStorage.setItem(d.LS_NEW_TAXY,JSON.stringify(e)),d.finished=!0,this.parseWebViewParam(e)}else{console.warn("taxy: retry getting cookie."),this.cookieRetry++;var s=this;setTimeout(function(){s.getCookie()},200)}},d.prototype.sendMessage=function(t,e,s){var n={data:{id:++this.messageId,method:t,data:e},callback:s};this.iframeReady?this.sendRequest(n):this.queue.push(n)},d.prototype.getCookie=function(){var e=this;this.sendMessage(p.MessageMethod.GET_COOKIE,null,function(t){e.loadCookie.call(e,t)})},d.prototype.createIframe=function(){var e=this;this.iframe=document.createElement("iframe"),this.forceOptout||this.forceOptin?this.forceOptout?this.iframe.src=p.Const.IFRM_URL+"?"+p.TaxyUtil.getRndParam()+"&forceOptout="+escape(this.forceOptout.toString()):this.forceOptin&&(this.iframe.src=p.Const.IFRM_URL+"?"+p.TaxyUtil.getRndParam()+"&forceOptin="+escape(this.forceOptin.toString())):this.iframe.src=p.Const.IFRM_URL+"?"+p.TaxyUtil.getRndParam()+"&publisher="+this.publisher+"&ua="+escape(this.ua)+"&referrer="+escape(this.referrer)+"&url="+escape(this.url)+"&pathname="+escape(this.pathname)+"&domain="+escape(this.domain)+"&lsOldData="+escape(this.lsOldData)+"&lsOldExt="+escape(this.lsOldExt)+"&createNew="+escape(this.createNew.toString())+"&optout="+escape(this.optout.toString())+"&sent="+escape(this.sent.toString())+"&webview="+escape(this.webview.toString()),this.iframe.width="1",this.iframe.height="1",this.iframe.frameBorder="0",this.iframe.border="0",this.iframe.style.position="fixed",this.iframe.style.top="-999px",this.iframe.style.left="-999px",this.iframe.style.border="none";var t=document.getElementsByTagName("body").item(0);if(null!=t){var s=t.children.item(0);if(t.insertBefore(this.iframe,s),!this.forceOptout){var n=new RegExp("(https?://[^/]+(:\\d+)?)/.+");this.origin=this.iframe.src.replace(n,"$1"),this.iframe.addEventListener("load",function(t){e.iframeLoaded()},!1),window.addEventListener("message",function(t){e.handleMessage(t)},!1)}}},d.prototype.saveExt=function(t,e){var s,n=window.localStorage.getItem(d.LS_NEW_TAXY);if(s=n?JSON.parse(n):{data:null,ext:null,custom:null,optout:!1,session_tc:null,c_ts:0,apl:null},t){var i=s.ext;t.date=(new Date).getTime(),t.id1&&"0"!=t.id1||(t.id1=i&&i.id1?i.id1:null),t.uuid&&"0"!=t.uuid||(t.uuid=i&&i.uuid?i.uuid:null),t.type||(t.type=i&&i.type?i.type:null),t.seed||(t.seed=i&&i.seed?i.seed:null)}s.ext=t,s.optout=!1,window.localStorage.setItem(d.LS_NEW_TAXY,JSON.stringify(s)),this.sendMessage(p.MessageMethod.SAVE_EXT,{data:null,ext:t,custom:null,optout:!1,session_tc:null,apl:null},e)},d.prototype.saveCustom=function(t,e){var s,n=window.localStorage.getItem(d.LS_NEW_TAXY);if(s=n?JSON.parse(n):{data:null,ext:null,custom:null,optout:!1,session_tc:null,apl:null,c_ts:0},t){var i=s.custom;t.date=(new Date).getTime(),t.id1&&"0"!=t.id1||(t.id1=i&&i.id1?i.id1:null),t.uuid&&"0"!=t.uuid||(t.uuid=i&&i.uuid?i.uuid:null),t.type||(t.type=i&&i.type?i.type:null),t.seed||(t.seed=i&&i.seed?i.seed:null),void 0===t.retry&&(t.retry=!1)}s.custom=t,window.localStorage.setItem(d.LS_NEW_TAXY,JSON.stringify(s)),this.sendMessage(p.MessageMethod.SAVE_CUSTOM,{data:null,ext:null,custom:t,optout:!1,session_tc:null,apl:null},e)},d.prototype.saveSessionTc=function(t,e){var s,n=window.localStorage.getItem(d.LS_NEW_TAXY);(s=n?JSON.parse(n):{data:null,ext:null,custom:null,optout:!1,session_tc:null,apl:null,c_ts:0}).session_tc=t.session_tc,window.localStorage.setItem(d.LS_NEW_TAXY,JSON.stringify(s)),this.sendMessage(p.MessageMethod.SAVE_SESSION,{data:null,ext:null,custom:null,optout:!1,session_tc:t.session_tc,apl:null},e)},d.main=function(){new d},d.registExt=function(t,e,s,n,i){null==d.instance.iframe&&d.instance.createIframe(),i||"function"!=typeof s||(i=s,s=void 0),p.TaxyUtil.add(t,e,s,n,function(){d.instance.saveExt.call(d.instance,arguments[0],function(){void 0!==i&&i()})})},d.registCustom=function(t,e,s,n,i){null==d.instance.iframe&&d.instance.createIframe(),p.TaxyUtil.add(t,e,s,n,function(){d.instance.saveCustom.call(d.instance,arguments[0],i)})},d.setCustomRetry=function(t){null==d.instance.iframe&&d.instance.createIframe();var e,s,n=window.localStorage.getItem(d.LS_NEW_TAXY);(s=(e=n?JSON.parse(n):{data:null,ext:null,custom:null,optout:!1,session_tc:null,apl:null,c_ts:0}).custom?e.custom:{id1:null,uuid:null,type:null,seed:null,date:0,retry:!1}).retry=t,d.instance.saveCustom.call(d.instance,s,function(){})},d.registSessionTc=function(t,e,s){null==d.instance.iframe&&d.instance.createIframe(),p.TaxyUtil.conv(t,function(){d.instance.saveSessionTc.call(d.instance,arguments[0],e)},s)},d.passenger3splayer=function(t,e){var s,n=window.localStorage.getItem(d.LS_NEW_TAXY);s=n?JSON.parse(n):{data:null,ext:null,custom:null,optout:!1,session_tc:null,apl:null,c_ts:0},p.TaxyUtil.passenger(JSON.stringify(s.data),null!=s.ext?JSON.stringify(s.ext):null,d.instance.pathname,d.instance.publisher,escape(d.instance.ua),escape(d.instance.referrer),"3splayer",d.instance.optout,s.session_tc,null!=s.custom?JSON.stringify(s.custom):null,t,e,null)},d.LD_SYS_REFERER="sys_referer",d.LS_OLD_DAT="um_taxy",d.LS_OLD_EXT="um_taxy_ext",d.LS_NEW_TAXY="um_c_taxy",d.JSPARAM_OPTOUT="optout",d.JSPARAM_WEBVIEW="webview",d.PAGEPARAM_BRWSCID="id2",d.PAGEPARAM_BRWSEXP="expire",d.PAGEPARAM_BRWSID1="id1",d.PAGEPARAM_BRWSUUID="uuid",d.PAGEPARAM_BRWSSEED="seed",d.PAGEPARAM_BRWSDATE="date",d.PAGEPARAM_BRWSID21="id21",d.MAX_COOKIE_RETRY=10,d.finished=!1,d}();(p.Taxy=t).main()}(taxy||(taxy={}));